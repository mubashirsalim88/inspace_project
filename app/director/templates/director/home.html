{% extends "base.html" %}
{% block title %}Director Dashboard - IN-SPACe{% endblock %}
{% block content %}
<div class="min-h-screen bg-blue-50 p-8">
    <h2 class="text-4xl font-extrabold text-blue-900 mb-4 animate__animated animate__fadeInDown">Director Dashboard</h2>
    <p class="text-gray-700 mb-8">Provide final approval for verified applications across modules.</p>

    <!-- Tab Navigation -->
    <div class="mb-8">
        <div class="border-b border-blue-200">
            <nav class="flex space-x-4">
                {% for module in fixed_modules %}
                <button class="tab-link py-2 px-3 text-blue-700 font-semibold border-b-2 {% if loop.first %}border-blue-600 text-blue-900{% else %}border-transparent hover:border-blue-400{% endif %}" data-tab="{{ module }}">{{ module|replace('_', ' ')|title }}</button>
                {% endfor %}
            </nav>
        </div>
    </div>

    <!-- Tab Content -->
    {% for module in fixed_modules %}
    <div id="{{ module }}" class="tab-content {% if not loop.first %}hidden{% endif %}">
        <!-- Pending Approval Section -->
        <div class="mb-12">
            <h3 class="text-2xl font-semibold text-blue-800 mb-4">{{ module|replace('_', ' ')|title }} - Pending Approval</h3>
            {% if module_apps[module] %}
            <div class="bg-white shadow-xl rounded-lg border border-blue-200 overflow-x-auto">
                <table class="w-full text-left">
                    <thead>
                        <tr class="bg-blue-100 text-blue-800">
                            <th class="p-4 font-semibold">ID</th>
                            <th class="p-4 font-semibold">Applicant</th>
                            <th class="p-4 font-semibold">Status</th>
                            <th class="p-4 font-semibold">Last Updated</th>
                            <th class="p-4 font-semibold">Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for app in module_apps[module]|sort(attribute='updated_at', reverse=True) %}
                        {% set is_new = (datetime.now() - app.updated_at).days <= 7 %}
                        {% set is_actionable = app.status == 'Pending Director Approval' %}
                        <tr class="border-b {% if is_actionable %}bg-yellow-50{% else %}hover:bg-gray-50{% endif %}">
                            <td class="p-4">{{ app.id }}</td>
                            <td class="p-4">{{ app.user.username }}</td>
                            <td class="p-4">
                                <span class="{% if app.status == 'Pending Director Approval' %}bg-yellow-200 text-yellow-800{% elif app.status == 'Approved' %}bg-green-200 text-green-800{% elif app.status == 'Rejected' %}bg-red-200 text-red-800{% else %}bg-gray-200 text-gray-800{% endif %} text-sm font-medium px-3 py-1 rounded-lg">{{ app.status }}</span>
                                {% if is_new %}
                                    <span class="bg-blue-200 text-blue-800 text-sm font-medium px-3 py-1 rounded-lg ml-2">New</span>
                                {% endif %}
                            </td>
                            <td class="p-4">{{ app.updated_at.strftime('%B %d, %Y') }}</td>
                            <td class="p-4">
                                {% if is_actionable %}
                                    <a href="{{ url_for('director.review', application_id=app.id) }}" class="py-2 px-4 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm font-semibold">Review Now</a>
                                {% else %}
                                    <span class="text-gray-500 text-sm">No Action</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <p class="text-gray-500 bg-white p-4 rounded-lg shadow-lg border border-blue-200 text-center">No {{ module|replace('_', ' ')|title }} applications pending approval.</p>
            {% endif %}
        </div>

        <!-- Completed Applications Section -->
        <div>
            <h3 class="text-2xl font-semibold text-blue-800 mb-4">{{ module|replace('_', ' ')|title }} - Completed Applications</h3>
            {% if completed_module_apps[module] %}
            <div class="bg-white shadow-xl rounded-lg border border-blue-200 overflow-x-auto">
                <table class="w-full text-left">
                    <thead>
                        <tr class="bg-blue-100 text-blue-800">
                            <th class="p-4 font-semibold">ID</th>
                            <th class="p-4 font-semibold">Applicant</th>
                            <th class="p-4 font-semibold">Status</th>
                            <th class="p-4 font-semibold">Last Updated</th>
                            <th class="p-4 font-semibold">Comments</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for app in completed_module_apps[module]|sort(attribute='updated_at', reverse=True) %}
                        <tr class="border-b hover:bg-gray-50">
                            <td class="p-4">{{ app.id }}</td>
                            <td class="p-4">{{ app.user.username }}</td>
                            <td class="p-4">
                                <span class="{% if app.status == 'Approved' %}bg-green-200 text-green-800{% elif app.status == 'Rejected' %}bg-red-200 text-red-800{% endif %} text-sm font-medium px-3 py-1 rounded-lg">{{ app.status }}</span>
                            </td>
                            <td class="p-4">{{ app.updated_at.strftime('%B %d, %Y') }}</td>
                            <td class="p-4">{{ app.comments or 'None' }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <p class="text-gray-500 bg-white p-4 rounded-lg shadow-lg border border-blue-200 text-center">No completed {{ module|replace('_', ' ')|title }} applications.</p>
            {% endif %}
        </div>
    </div>
    {% endfor %}
</div>

<script>
document.addEventListener("DOMContentLoaded", function () {
    const tabLinks = document.querySelectorAll(".tab-link");
    const tabContents = document.querySelectorAll(".tab-content");

    tabLinks.forEach(link => {
        link.addEventListener("click", () => {
            const tabId = link.getAttribute("data-tab");

            // Update active tab link
            tabLinks.forEach(l => {
                l.classList.remove("border-blue-600", "text-blue-900");
                l.classList.add("border-transparent", "hover:border-blue-400");
            });
            link.classList.add("border-blue-600", "text-blue-900");
            link.classList.remove("border-transparent", "hover:border-blue-400");

            // Show selected tab content
            tabContents.forEach(content => content.classList.add("hidden"));
            document.getElementById(tabId).classList.remove("hidden");
        });
    });
});
</script>
{% endblock %}